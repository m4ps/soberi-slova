# ADR-033: Runtime-диагностика только в dev-контуре

- Статус: accepted
- Дата: 2026-02-25
- Связанные задачи: [CODE]-[290]

## Контекст

Для задачи `[CODE]-[290]` требовалось убрать debug-only артефакты из production runtime без потери воспроизводимости smoke/E2E-проверок.

До изменения диагностические хуки `window.render_game_to_text` и `window.advanceTime(ms)` выставлялись всегда, включая production-сборку. Эти API нужны для автоматизации тестов и отладки, но не являются частью пользовательского контракта v1.

## Решение

1. Ограничить экспорт диагностических хуков только dev-режимом (`import.meta.env.DEV`) в `src/main.ts`.
2. На старте bootstrap и в fail-path явно очищать debug hooks из `window` для production-контуров.
3. Сделать типы глобальных API опциональными в `src/types/global.d.ts`, чтобы контракт отражал фактическое условное наличие хуков.

## Последствия

- Production-сборка не экспортирует test/debug API в глобальный runtime.
- Smoke/E2E-пайплайн `develop-web-game` сохраняет работоспособность в dev-контуре.
- Поверхность публичного runtime упрощена: debug-интерфейс отделён от пользовательского функционала.
