# ADR-035: Диагональный swipe через directional snapping + hysteresis + интерполяцию

- Статус: accepted
- Дата: 2026-02-25
- Связанные задачи: [CODE]-[010]

## Контекст

После внедрения базового `InputPath` (`CODE-002`) проявился дефект диагонального ввода:

- при шумном off-axis жесте диагональный переход часто схлопывался в вертикаль/горизонталь;
- при редких `pointermove` событиях терялись промежуточные клетки;
- при попытке компенсировать шум возрастал риск ложных переходов и регрессий `tail-undo`.

Это нарушало DOD задачи `[CODE]-[010]`: диагональные переходы должны быть предсказуемыми на реальных жестах без деградации обычных осевых свайпов.

## Решение

1. Перевести обработку `pointermove` на интерполяционный проход:
   - между двумя pointer-точками генерируется последовательность промежуточных sample-точек;
   - для каждого sample выполняется отдельная попытка продвинуть путь на одну соседнюю клетку.

2. Добавить directional snapping на уровне `InputPath`:
   - направление выбирается по вектору от центра последней клетки к текущей sample-точке;
   - при достаточной доле обеих компонент (`x/y`) разрешается диагональный шаг;
   - шаг остаётся в рамках `8-way adjacency`.

3. Ввести hysteresis:
   - при уже выбранном диагональном/осевом тренде пороги переключения ослабляются/ужесточаются так, чтобы уменьшить “дребезг” между направлениями.

4. Добавить guard согласованности с фактическим движением pointer:
   - шаги, направленные против текущего вектора движения sample-точек, отклоняются;
   - это предотвращает ложные осевые отклонения после диагонального snap при шумном трекинге.

5. Зафиксировать поведение тестами:
   - регресс-кейс off-axis диагонального жеста;
   - sparse-сценарий с большим шагом pointer и восстановлением диагональной цепочки.

## Последствия

- Диагональные переходы стали стабильнее при шумном вводе.
- Быстрые жесты с редкими pointer-событиями теперь корректно восстанавливают промежуточные клетки.
- Базовые правила `adjacency`, `tail-undo` и silent-ignore для невалидных/повторных клеток сохранены.
- Подготовлен фундамент для следующей тестовой задачи `[TEST]-[008]` (регрессы диагонального свайпа).
