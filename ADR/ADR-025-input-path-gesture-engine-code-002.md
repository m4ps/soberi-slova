# ADR-025: Gesture-driven InputPath engine для swipe-path и tail-undo

- Статус: accepted
- Дата: 2026-02-25
- Связанные задачи: [CODE]-[002]

## Контекст

Для задачи `CODE-002` требовалось заменить bootstrap-обработчик `pointerup -> Tick` на рабочий `InputPath`:

- собирать путь только в рамках одного swipe/drag-жеста;
- разрешать только соседние клетки (8 направлений);
- запрещать повторное использование клетки в одном слове;
- поддерживать только `tail-undo` (возврат в предыдущую клетку);
- мягко игнорировать невалидные/повторные клетки;
- отправлять `SubmitPath` только на отпускании пальца.

## Решение

1. Ввести внутри адаптера `InputPathEngine`, который хранит состояние активного жеста и путь текущего слова.
2. Добавить чистый helper `resolveGridCellFromPointer(pointer, bounds)` для маппинга координат `canvas` в `5x5` grid.
3. Закрепить правила path-эволюции в engine:
   - добавление клетки только при adjacency к хвосту;
   - повтор текущей клетки игнорируется;
   - возврат только на предыдущую клетку удаляет хвост (`tail-undo`);
   - любой другой повтор и не-соседняя клетка игнорируются.
4. Перевести adapter lifecycle на `pointerdown/move/up/cancel`:
   - `pointerup` завершает жест и dispatch-ит `SubmitPath`;
   - `pointercancel` отменяет жест без submit;
   - активный `pointerId` фиксируется для защиты от конкурирующих multi-touch событий.
5. Добавить unit-тесты path-контракта и adapter-wiring (`tests/input-path.adapter.test.ts`).

## Последствия

- Контракт `PRD 6.x` для swipe-пути и `tail-undo` реализован на уровне ввода до доменной валидации слов.
- Поведение InputPath стало детерминированным и тестируемым без браузерного UI.
- Подготовлена чистая интеграционная точка для следующих задач `CODE-003` (`WordValidation`) и `CODE-004` (`CoreState scoring/progression`).
